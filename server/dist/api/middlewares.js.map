{"version":3,"sources":["../../src/api/middlewares.js"],"names":["loginRequired","req","res","next","header","status","send","message","try_token","split","token","verifyToken","err","payload","UserModel","findById","sub","exec","user","error","password"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;kBAEe;AACbA,iBAAe,uBAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjC,QAAI,CAACF,IAAIG,MAAJ,CAAW,eAAX,CAAL,EAAkC,OAAOF,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,SAAS,4DAAV,EAArB,CAAP;;AAElC;AACA,QAAIC,YAAYP,IAAIG,MAAJ,CAAW,eAAX,EAA4BK,KAA5B,CAAkC,GAAlC,EAAuC,CAAvC,CAAhB;AACAC,oBAAMC,WAAN,CAAkBH,SAAlB,EAA6B,UAACI,GAAD,EAAMC,OAAN,EAAkB;AAC7C,UAAID,GAAJ,EAAS,OAAOV,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBM,GAArB,CAAP;AACTE,sBAAUC,QAAV,CAAmBF,QAAQG,GAA3B,EACGC,IADH,CACQ,UAACL,GAAD,EAAMM,IAAN,EAAe;AACnB,YAAIN,OAAO,CAACM,IAAZ,EAAkB;AACd,iBAAOhB,IAAIG,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBM,OAAO;AAC/BO,mBAAO;AADwB,WAA5B,CAAP;AAGH;AACD,eAAOD,KAAKE,QAAZ;AACAnB,YAAIiB,IAAJ,GAAWA,IAAX;AACAf;AACD,OAVH;AAWD,KAbD;AAcD;AApBY,C","file":"middlewares.js","sourcesContent":["import UserModel from '../user/model';\nimport token from '../util/token';\n\nexport default {\n  loginRequired: (req, res, next) => {\n    if (!req.header('Authorization')) return res.status(401).send({message: 'Please make sure your request has an Authorization header.'});\n    \n    // Validate jwt\n    let try_token = req.header('Authorization').split(' ')[0];\n    token.verifyToken(try_token, (err, payload) => {\n      if (err) return res.status(401).send(err);\n      UserModel.findById(payload.sub)\n        .exec((err, user) => {\n          if (err || !user) {\n              return res.status(404).send(err || {\n                  error: 'middleware User not found!!!'\n              });\n          }\n          delete user.password;\n          req.user = user;\n          next();\n        })\n    })\n  }\n}"]}